use std::env;
use std::fs::File;

macro_rules! Void {
	() => {
		Option::<Dummy>::None
	};
}

// God forsaken code here
struct Dummy {}

impl std::fmt::Debug for Dummy {
	fn fmt(&self, _f: &mut std::fmt::Formatter) -> std::fmt::Result {
		return Ok(());
	}
}


fn abort<T, U: std::fmt::Debug>(s: &str, err: Option<U>) -> T {
	match err {
		| Some(e) => eprintln!("Aborting: {}\n\t{:#?}", s, e),
		| None => eprintln!("Aborting: {}", s),
	}
	std::process::exit(1);
}

fn main() {
	let args: Vec<String> = env::args().collect();

	match args.len() {
		| 1 => abort("Not enough arguments: the first argument must be the target template", Void!()),
		| 2 => abort("Not enough arguments: the second argument must be the type to complete the template with", Void!()),
		| _ => (),
	}

	let target_filename: &str = &args[1];
	let target_type: &str = &args[2];

	let target_file = match File::open(target_filename) {
		| Ok(f) => f,
		| Err(e) => abort("Failed to open the file", Some(e)),
	};
}
